<?xml version="1.0" standalone="no"?>

<kickstart>

<description>
HDF (Hierarchical Object Oriented Format) libraries module files
http://www.hdfgroup.org/products/hdf4
http://www.hdfgroup.org/products/hdf5
</description>

<copyright>
Copyright (c) 2000 - 2011 The Regents of the University of California.
All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
</copyright>

<changelog>
</changelog>

<post>

<!-- HDF4 -->

for COMPILER in `ls /opt/hdf4`; do

  /bin/mkdir -m 0755 -p /opt/modulefiles/applications/.$COMPILER/hdf4

  cat &gt; /opt/modulefiles/applications/.$COMPILER/hdf4/2r4 &lt;&lt; END
#%Module1.0
module-whatis "hdf4"
module-whatis "Version: 2r4"
module-whatis "Description: hdf4"
module-whatis "Compiler: $COMPILER"
set hdf4Home /opt/hdf4/$COMPILER
setenv HDF4HOME \$hdf4Home
prepend-path PATH \$hdf4Home/bin
prepend-path LD_LIBRARY_PATH \$hdf4Home/lib
prepend-path LIBPATH \$hdf4Home/lib
END
  chmod 0644 /opt/modulefiles/applications/.$COMPILER/hdf4/2r4

  cat &gt; /opt/modulefiles/applications/.$COMPILER/hdf4/.version.2r4 &lt;&lt; END
#%Module1.0
set ModulesVersion "2r4"
END
  chmod 0644 /opt/modulefiles/applications/.$COMPILER/hdf4/.version.2r4

  /bin/ln -s /opt/modulefiles/applications/.$COMPILER/hdf4/.version.2r4 \
             /opt/modulefiles/applications/.$COMPILER/hdf4/.version

done

<!-- HDF5 -->

for COMPILER in `ls /opt/hdf5`; do

  /bin/mkdir -m 0755 -p /opt/modulefiles/applications/.$COMPILER/hdf5

  cat &gt; /opt/modulefiles/applications/.$COMPILER/hdf5/1.8.3 &lt;&lt; END
#%Module1.0
if {! [info exists ::env(MPIHOME)]} {
  puts stderr "Need to load an mpi module before loading hdf5"
  exit 1
}
foreach {x} [glob -directory /opt/hdf5/$COMPILER -tails *] {
  if {[regexp \$x \$::env(MPIHOME)]} {
    set mpi \$x
    break
  }
}
if {! [info exists mpi]} {
  puts stderr "No supported MPI flavor found"
  exit 1
}
foreach {x} [glob -directory /opt/hdf5/$COMPILER/\$mpi -tails *] {
  if {[regexp \$x \$::env(MPIHOME)]} {
    set network \$x
    break
  }
}
if {! [info exists network]} {
  puts stderr "No supported network found"
  exit 1
}
module-whatis "hdf5"
module-whatis "Version: 1.8.3"
module-whatis "Description: hdf5"
module-whatis "Compiler: $COMPILER"
module-whatis "MPI: $mpi $network"
set hdf5Home /opt/hdf5/$COMPILER/\$mpi/\$network
setenv HDF5HOME \$hdf5Home
prepend-path PATH \$hdf5Home/bin
prepend-path LD_LIBRARY_PATH \$hdf5Home/lib
prepend-path LIBPATH \$hdf5Home/lib
END
  chmod 0644 /opt/modulefiles/applications/.$COMPILER/hdf5/1.8.3

  cat &gt; /opt/modulefiles/applications/.$COMPILER/hdf5/.version.1.8.3 &lt;&lt; END
#%Module1.0
set ModulesVersion "1.8.3"
END
  chmod 0644 /opt/modulefiles/applications/.$COMPILER/hdf5/.version.1.8.3

  /bin/ln -s /opt/modulefiles/applications/.$COMPILER/hdf5/.version.1.8.3 \
             /opt/modulefiles/applications/.$COMPILER/hdf5/.version

done

</post>

</kickstart>
